<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VoiceLauncherWasm</title>
    <base href="/" />
    <link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
    <link rel="stylesheet" href="css/app.css" />
    <link rel="icon" type="image/png" href="favicon.png" />
    <link href="VoiceLauncherWasm.styles.css" rel="stylesheet" />
</head>

<body>
    <div id="app">
        <svg class="loading-progress">
            <circle r="40%" cx="50%" cy="50%" />
            <circle r="40%" cx="50%" cy="50%" />
        </svg>
        <div class="loading-progress-text"></div>
    </div>

    <div id="blazor-error-ui">
        An unhandled error has occurred.
        <a href="" class="reload">Reload</a>
        <a class="dismiss">ðŸ—™</a>
    </div>
    <script>
        // Global error handlers to surface early errors (before Blazor can render error UI)
        (function () {
            function showBlazorError(message) {
                try {
                    console.error(message);
                    var ui = document.getElementById('blazor-error-ui');
                    if (ui) {
                        ui.style.display = 'block';
                        // append detailed message
                        var pre = document.createElement('pre');
                        pre.style.whiteSpace = 'pre-wrap';
                        pre.style.maxHeight = '200px';
                        pre.style.overflow = 'auto';
                        pre.textContent = typeof message === 'string' ? message : JSON.stringify(message, null, 2);
                        // remove previous detail if present
                        var existing = ui.querySelector('pre');
                        if (existing) existing.remove();
                        ui.appendChild(pre);
                    }
                } catch (e) {
                    console.error('Error showing blazor UI message', e);
                }
            }

            window.addEventListener('error', function (ev) {
                var msg = ev && ev.error && ev.error.stack ? ev.error.stack : (ev && ev.message) || String(ev);
                showBlazorError('Global error: ' + msg);
            });

            window.addEventListener('unhandledrejection', function (ev) {
                var reason = ev && ev.reason ? (ev.reason.stack || ev.reason) : ev;
                showBlazorError('Unhandled rejection: ' + (typeof reason === 'string' ? reason : JSON.stringify(reason)));
            });
        })();
    </script>
    <script src="js/indexeddb.js"></script>
    <script src="_framework/blazor.webassembly.js"
            onload="console.log('blazor.webassembly.js loaded')"
            onerror="console.error('Failed to load blazor.webassembly.js', event)"></script>
    <script>
        // Diagnostic: after a short delay check whether the DotNet runtime is present
        setTimeout(function () {
            if (!window.DotNet) {
                console.error('DotNet runtime not detected on window after 5s');
            } else {
                console.log('DotNet runtime detected');
            }
        }, 5000);
    </script>
</body>

</html>
